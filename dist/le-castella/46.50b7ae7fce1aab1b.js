"use strict";(self.webpackChunkle_castella=self.webpackChunkle_castella||[]).push([[46],{1046:(q,d,i)=>{i.r(d),i.d(d,{UserModule:()=>k});var _=i(6814),p=i(2787),s=i(95),x=i(8645),h=i(4716),P=i(9773),n=i(5879),b=i(603),m=i(7845),C=i(9862);let T=(()=>{class o{constructor(t){this._httpClient=t}getProfile(){return this._httpClient.get(`${m.N.apiPrefixUrl}/admin/profile`)}updateProfile(t){return this._httpClient.put(`${m.N.apiPrefixUrl}/admin/profile`,t)}changePassword(t){return this._httpClient.put(`${m.N.apiPrefixUrl}/admin/profile/password`,t)}static#n=this.\u0275fac=function(e){return new(e||o)(n.LFG(C.eN))};static#t=this.\u0275prov=n.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Z=i(2561),u=i(3626),g=i(2920),c=i(3599),f=i(824),w=i(2840),v=i(855),y=i(1958),z=i(2595);const F=["newPasswordField"],N=["confirmPasswordField"];function S(o,l){if(1&o){const t=n.EpF();n.TgZ(0,"button",19),n.NdJ("click",function(){n.CHM(t);const r=n.oxw(2);return n.KtG(r.chooseChange())}),n._uU(1,"Change Password "),n.qZA()}}function J(o,l){if(1&o){const t=n.EpF();n.TgZ(0,"span",35),n.NdJ("click",function(){n.CHM(t);const r=n.oxw(3);return n.KtG(r.passwordVisibleOld=!r.passwordVisibleOld)}),n.qZA()}if(2&o){const t=n.oxw(3);n.Q6J("nzType",t.passwordVisibleOld?"eye-invisible":"eye")}}function A(o,l){if(1&o){const t=n.EpF();n.TgZ(0,"span",35),n.NdJ("click",function(){n.CHM(t);const r=n.oxw(3);return n.KtG(r.passwordVisibleNew=!r.passwordVisibleNew)}),n.qZA()}if(2&o){const t=n.oxw(3);n.Q6J("nzType",t.passwordVisibleNew?"eye-invisible":"eye")}}function U(o,l){if(1&o){const t=n.EpF();n.TgZ(0,"span",35),n.NdJ("click",function(){n.CHM(t);const r=n.oxw(3);return n.KtG(r.passwordVisibleConfirm=!r.passwordVisibleConfirm)}),n.qZA()}if(2&o){const t=n.oxw(3);n.Q6J("nzType",t.passwordVisibleConfirm?"eye-invisible":"eye")}}function Q(o,l){1&o&&(n.TgZ(0,"div")(1,"span",10),n._uU(2,"Passwords do not match."),n.qZA()())}function M(o,l){if(1&o){const t=n.EpF();n.TgZ(0,"form",5)(1,"nz-form-item")(2,"nz-form-label",20),n._uU(3,"Old Password"),n.TgZ(4,"span",10),n._uU(5,"\xa0*"),n.qZA()(),n.TgZ(6,"nz-form-control",21)(7,"nz-input-group",22),n._UZ(8,"input",23),n.qZA(),n.YNc(9,J,1,1,"ng-template",null,24,n.W1O),n.qZA()(),n.TgZ(11,"nz-form-item")(12,"nz-form-label",25),n._uU(13,"New Password"),n.TgZ(14,"span",10),n._uU(15,"\xa0*"),n.qZA()(),n.TgZ(16,"nz-form-control",26)(17,"nz-input-group",22),n._UZ(18,"input",27,28),n.qZA(),n.YNc(20,A,1,1,"ng-template",null,29,n.W1O),n.qZA()(),n.TgZ(22,"nz-form-item")(23,"nz-form-label",30),n._uU(24,"Confirm New Password"),n.TgZ(25,"span",10),n._uU(26,"\xa0*"),n.qZA()(),n.TgZ(27,"nz-form-control",31)(28,"nz-input-group",22)(29,"input",32,33),n.NdJ("blur",function(){n.CHM(t);const r=n.oxw(2);return n.KtG(r.validatePasswordMatch())}),n.qZA()(),n.YNc(31,U,1,1,"ng-template",null,34,n.W1O),n.YNc(33,Q,3,0,"div",0),n.qZA()(),n.TgZ(34,"nz-form-item",13)(35,"nz-form-control",14)(36,"button",19),n.NdJ("click",function(){n.CHM(t);const r=n.oxw(2);return n.KtG(r.submitPasswordForm())}),n._uU(37," Confirm "),n.qZA(),n.TgZ(38,"button",16),n.NdJ("click",function(){n.CHM(t);const r=n.oxw(2);return n.KtG(r.cancelChange())}),n._uU(39,"Cancel"),n.qZA()()()()}if(2&o){const t=n.MAs(10),e=n.MAs(21),r=n.MAs(32),a=n.oxw(2);n.Q6J("formGroup",a.passwordForm),n.xp6(2),n.Q6J("nzSpan",3),n.xp6(4),n.Q6J("nzSpan",8),n.xp6(1),n.Q6J("nzSuffix",t),n.xp6(1),n.Q6J("type",a.passwordVisibleOld?"text":"password"),n.xp6(4),n.Q6J("nzSpan",3),n.xp6(4),n.Q6J("nzSpan",8),n.xp6(1),n.Q6J("nzSuffix",e),n.xp6(1),n.Q6J("type",a.passwordVisibleNew?"text":"password"),n.xp6(5),n.Q6J("nzSpan",3),n.xp6(4),n.Q6J("nzSpan",8),n.xp6(1),n.Q6J("nzSuffix",r),n.xp6(1),n.Q6J("type",a.passwordVisibleConfirm?"text":"password"),n.xp6(4),n.Q6J("ngIf",a.mismatchPassword),n.xp6(2),n.Q6J("nzSpan",12)("nzOffset",3)}}const E=function(){return["/admin/profile"]};function G(o,l){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"div",1)(2,"nz-breadcrumb",2)(3,"nz-breadcrumb-item",3),n._uU(4,"Profile "),n.qZA(),n.TgZ(5,"nz-breadcrumb-item",4),n._uU(6,"Edit Profile"),n.qZA()(),n.TgZ(7,"h4"),n._uU(8,"My Profile"),n.qZA(),n.TgZ(9,"form",5)(10,"nz-form-item")(11,"nz-form-label",6),n._uU(12,"Username"),n.qZA(),n.TgZ(13,"nz-form-control",7),n._UZ(14,"input",8),n.qZA()(),n.TgZ(15,"nz-form-item")(16,"nz-form-label",9),n._uU(17,"Full Name"),n.TgZ(18,"span",10),n._uU(19,"\xa0*"),n.qZA()(),n.TgZ(20,"nz-form-control",11),n._UZ(21,"input",12),n.qZA()(),n.TgZ(22,"nz-form-item",13)(23,"nz-form-control",14)(24,"button",15),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.submitProfileForm())}),n._uU(25,"Update"),n.qZA(),n.TgZ(26,"button",16),n.NdJ("click",function(){n.CHM(t);const r=n.oxw();return n.KtG(r.reset())}),n._uU(27,"Cancel"),n.qZA(),n.YNc(28,S,2,0,"button",17),n.qZA()()(),n.YNc(29,M,40,16,"form",18),n.qZA(),n.BQk()}if(2&o){const t=n.oxw();n.xp6(3),n.Q6J("routerLink",n.DdM(10,E)),n.xp6(6),n.Q6J("formGroup",t.profileForm),n.xp6(2),n.Q6J("nzSpan",3),n.xp6(2),n.Q6J("nzSpan",8),n.xp6(3),n.Q6J("nzSpan",3),n.xp6(4),n.Q6J("nzSpan",8),n.xp6(3),n.Q6J("nzSpan",12)("nzOffset",3),n.xp6(5),n.Q6J("ngIf",!t.isChangePassword),n.xp6(1),n.Q6J("ngIf",t.isChangePassword)}}const V=[{path:"",component:(()=>{class o{constructor(t,e,r,a){this._fb=t,this._authService=e,this._profileService=r,this._notification=a,this.unsubscribe$=new x.x,this.isChangePassword=!1,this.isSubmitProfile=!1,this.isSubmitPassword=!1,this.mismatchPassword=!1,this.passwordVisibleOld=!1,this.passwordVisibleNew=!1,this.passwordVisibleConfirm=!1}ngOnInit(){this.profileForm=this._fb.group({username:[this.username||"",[s.kI.required]],fullName:[this.fullName||"",[s.kI.required]]}),this.loadProfile()}submitProfileForm(){this.validateForm(this.profileForm)&&(this.isSubmitProfile=!0,this._profileService.updateProfile(this.profileForm.value).pipe((0,h.x)(()=>this.isSubmitProfile=!1)).subscribe({next:t=>{this._notification.success("Congratulation!","Update Profile successful!"),this.loadProfile()},error:t=>{400==t.status&&this._notification.error("",t.error)}}))}loadProfile(){this._profileService.getProfile().pipe((0,P.R)(this.unsubscribe$)).subscribe({next:t=>{this.username=t.username,this.fullName=t.fullName,this.profileForm.get("username")?.setValue(this.username||""),this.profileForm.get("fullName")?.setValue(this.fullName||"")},error:t=>{}})}reset(){this.loadProfile()}chooseChange(){this.isChangePassword=!0,this.passwordForm=this._fb.group({oldPassword:["",[s.kI.required]],newPassword:["",[s.kI.required]],confirmPassword:["",[s.kI.required]]})}submitPasswordForm(){this.validateForm(this.passwordForm)&&(this.isSubmitPassword=!0,this._profileService.changePassword(this.passwordForm.value).pipe((0,h.x)(()=>this.isSubmitPassword=!1)).subscribe({next:t=>{this._notification.success("Congratulation!","Change Password successful!"),this.isChangePassword=!1},error:t=>{400==t.status&&this._notification.error("",t.error)}}))}cancelChange(){this.passwordForm.reset(),this.isChangePassword=!1}validateForm(t){return this.validatePasswordMatch(),!(this.mismatchPassword||t.invalid&&(Object.values(t.controls).forEach(e=>{e.invalid&&(e.markAsDirty(),e.updateValueAndValidity({onlySelf:!0}))}),1))}validatePasswordMatch(){const t=this.newPasswordField?.nativeElement?.value,e=this.confirmPasswordField?.nativeElement?.value;this.mismatchPassword=t!==e}static#n=this.\u0275fac=function(e){return new(e||o)(n.Y36(s.qu),n.Y36(b.e),n.Y36(T),n.Y36(Z.zb))};static#t=this.\u0275cmp=n.Xpm({type:o,selectors:[["app-profile"]],viewQuery:function(e,r){if(1&e&&(n.Gf(F,5),n.Gf(N,5)),2&e){let a;n.iGM(a=n.CRH())&&(r.newPasswordField=a.first),n.iGM(a=n.CRH())&&(r.confirmPasswordField=a.first)}},decls:1,vars:1,consts:[[4,"ngIf"],[1,"px-3","pb-4"],["nzSeparator",">",1,"text-start","py-3"],["role","button",1,"text-primary","fw-bold",3,"routerLink"],[1,"text-primary","fw-bold"],["nz-form","",1,"mt-5",3,"formGroup"],["nzFor","username",1,"d-flex","justify-content-start",3,"nzSpan"],["nzErrorTip","Username is required!",3,"nzSpan"],["readonly","","nz-input","","type","text","id","username","placeholder","Enter username...","formControlName","username",1,"border","border-secondary","disabled-input"],["nzFor","fullName",1,"d-flex","justify-content-start",3,"nzSpan"],[1,"text-danger"],["nzErrorTip","Full name is required!",3,"nzSpan"],["nz-input","","type","text","id","fullName","placeholder","Enter full name...","formControlName","fullName",1,"border","border-secondary"],["nz-row","",1,"register-area"],[3,"nzSpan","nzOffset"],["nz-button","","nzType","primary",1,"rounded","fw-bold","me-3",3,"click"],["nz-button","",1,"rounded","fw-bold","me-3",3,"click"],["class","rounded fw-bold me-3","nz-button","","nzType","primary","nzGhost","",3,"click",4,"ngIf"],["nz-form","","class","mt-5",3,"formGroup",4,"ngIf"],["nz-button","","nzType","primary","nzGhost","",1,"rounded","fw-bold","me-3",3,"click"],["nzFor","oldPass",1,"d-flex","justify-content-start",3,"nzSpan"],["nzErrorTip","Old Password is required!",3,"nzSpan"],[1,"border","border-secondary",3,"nzSuffix"],["id","oldPass","nz-input","","placeholder","Enter old password...","formControlName","oldPassword",3,"type"],["suffixTemplateOld",""],["nzFor","newPass",1,"d-flex","justify-content-start",3,"nzSpan"],["nzErrorTip","New password is required!",3,"nzSpan"],["id","newPass","nz-input","","placeholder","Enter new password...","formControlName","newPassword",3,"type"],["newPasswordField",""],["suffixTemplateNew",""],["nzFor","confirm",1,"d-flex","justify-content-start",3,"nzSpan"],["nzErrorTip","Confirm new password is required!",3,"nzSpan"],["id","confirm","nz-input","","placeholder","Enter confirm password...","formControlName","confirmPassword",3,"type","blur"],["confirmPasswordField",""],["suffixTemplateConfirm",""],["nz-icon","",3,"nzType","click"]],template:function(e,r){1&e&&n.YNc(0,G,30,11,"ng-container",0),2&e&&n.Q6J("ngIf",r.username)},dependencies:[_.O5,p.rH,u.Dg,u.MO,g.t3,g.SK,c.Lr,c.Nx,c.iK,c.Fd,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,f.Zp,f.gB,f.ke,w.ix,v.w,y.dQ,z.Ls],styles:[".disabled-input[_ngcontent-%COMP%]{background-color:#ddd;color:#b7b7b7;cursor:not-allowed}"]})}return o})()}];let O=(()=>{class o{static#n=this.\u0275fac=function(e){return new(e||o)};static#t=this.\u0275mod=n.oAB({type:o});static#o=this.\u0275inj=n.cJS({imports:[p.Bz.forChild(V),p.Bz]})}return o})(),k=(()=>{class o{static#n=this.\u0275fac=function(e){return new(e||o)};static#t=this.\u0275mod=n.oAB({type:o});static#o=this.\u0275inj=n.cJS({imports:[_.ez,O,u.lt,c.U5,s.UX,f.o7,w.sL,z.PV]})}return o})()}}]);